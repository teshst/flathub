---
# Stardrop Flatpak manifest
# Credit to Adda0 creator of StardropForked Flatpak manifest that was used as reference for this manifest.
# https://github.com/flathub/io.github.Adda0.Stardrop

app-id: io.github.teshst.Stardrop
runtime: org.freedesktop.Platform
runtime-version: "23.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.dotnet7
build-options:
  append-path: /usr/lib/sdk/dotnet7/bin
  append-ld-library-path: /usr/lib/sdk/dotnet7/lib
  prepend-pkg-config-path: /usr/lib/sdk/dotnet7/lib/pkgconfig
command: "Stardrop"
finish-args:
  - "--socket=x11"
  - "--share=ipc"
  - "--share=network"
  - "--device=dri"
  - "--filesystem=xdg-download"
  - "--filesystem=~/.local/share/Steam/steamapps/common/Stardew Valley"
  - "--filesystem=~/.var/app/com.valvesoftware.Steam/data/Steam/steamapps/common/Stardew Valley"
  - "--socket=pulseaudio"
modules:
  - name: Stardrop
    buildsystem: simple
    build-commands:
      - "install-sdk.sh"
      - "dotnet publish -c Linux --source ./nuget-sources Stardrop/Stardrop.csproj --self-contained true"
      - cp -r /run/build/Stardrop/Stardrop/bin/Linux/linux-*/publish/* /app/bin/
    sources:
      - nuget-sources.json
      - type: archive
        url: "https://github.com/teshst/Stardrop/archive/refs/tags/v1.2.0.tar.gz"
        sha512: afd6a87827c5aae4f5b64e75e3d4a11d26e05d40fc4989c1c79f70748b51947719111fb296ec7c8429bfc9dd97ec0bb5d24dc98f2de1c670f3d59c571cbf08b4
      - type: file
        path: global.json
  - name: Meta
    buildsystem: simple
    build-commands:
      - install -Dm644 $FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
      - install -Dm644 $FLATPAK_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -Dm644 Stardrop_512x512x32.png /app/share/icons/hicolor/512x512/apps/$FLATPAK_ID.png
    sources:
      - type: file
        path: io.github.teshst.Stardrop.metainfo.xml
      - type: file
        path: io.github.teshst.Stardrop.desktop
      - type: file
        path: Stardrop_512x512x32.png
